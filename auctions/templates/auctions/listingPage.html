{% extends "auctions/layout.html" %}

{% block body %}
{% for attribute in item %}
    <div id="itemGeneralInfo">
        <div class="mainImg">
            <img src="{{ attribute.listingImg }}" alt="Auction item image" style="max-width: 450px; height: auto;">
        </div>
        <div class="listingInfo p-4">
            <h3 class="font-medium leading-tight text-3xl p-1">{{ attribute.itemTitle }}</h3>
            <!--Maybe use form for this-->
            {% if attribute.isActive %}
                <form action="{% url 'watchlist' %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" id="title" name="title" value="{{ attribute.itemTitle }}">
                    <input type="submit" id="addWish" value="+ Add to wishlist" 
                    class="inline-block px-6 py-2.5 bg-blue-600 text-white font-medium text-xs leading-tight 
                    uppercase rounded-full shadow-md hover:bg-blue-700 hover:shadow-lg focus:bg-blue-700 focus:shadow-lg 
                    focus:outline-none focus:ring-0 active:bg-blue-800 active:shadow-lg transition duration-150 ease-in-out">   
                    {% for item in watchlistStatus%}
                        {% if item.itemTitle == attribute.itemTitle %}
                            <input type="submit" value="- Remove from wishlist" 
                            class="inline-block px-6 py-2.5 bg-red-600 text-white font-medium text-xs leading-tight uppercase rounded-full 
                            shadow-md hover:bg-red-700 hover:shadow-lg focus:bg-red-700 focus:shadow-lg focus:outline-none focus:ring-0 
                            active:bg-red-800 active:shadow-lg transition duration-150 ease-in-out">
                            <style>
                                #addWish {
                                    display: none;
                                }
                            </style>
                        {% endif %}
                    {% endfor %}
                </form>
            {% endif %}
            {% if currentBid > attribute.initialBid %}
                <span class="p-1"><b>Highest Bid:</b> {{ currentBid }}</span>
                <br>
                <span class="p-1"><b>Initial Price:</b> {{ attribute.initialBid }}</span>
            {% else %}
                <span class="p-1"><b>Highest Bid:</b> None</span>
                <br>
                <span class="p-1"><b>Initial Price:</b> {{ attribute.initialBid }}</span>
            {% endif %}
            <p><b>Owner:</b> {{ attribute.user }}</p>
            <p><b>Category:</b> {{ attribute.get_category_display }}</p>
            {% if user.is_authenticated and attribute.user == request.user and attribute.isActive %}
                <form action="{% url 'close' %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" id="listingOwner" name="listingOwner" value="{{ attribute.user }}">
                    <input type="hidden" id="closeListing" name="closeListing" value="{{ attribute.itemTitle }}">
                    <input type="submit" id="closeListingButton" value="Close Auction" 
                    class="inline-block px-6 py-2.5 bg-blue-400 text-white font-medium text-xs leading-tight uppercase 
                    rounded shadow-md hover:bg-blue-500 hover:shadow-lg focus:bg-blue-500 focus:shadow-lg focus:outline-none 
                    focus:ring-0 active:bg-blue-600 active:shadow-lg transition duration-150 ease-in-out" 
                    onsubmit="return confirm('Are you sure you want to end this auction?');">
                </form>
            {% endif %}
        </div>
    </div>
    <ul class="messages" style="list-style: none;">
                    {% for message in messages %}
                    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                    {% endfor %}
    </ul>
    {% if attribute.isActive %}
        <form action="" method="POST">
            {% csrf_token %}
            <label for="bidForm" class="">Place a bid:</label>
            <input type="number" id="bidForm" name="bidForm" step="0.01" 
            class="form-control block w-1/4 px-3 py-1.5 text-base font-normal text-gray-700
            bg-white bg-clip-padding border border-solid border-black rounded transition
            ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none">
            <input type="submit" class="btn btn-info mt-2 ml-2">
        </form>
    {% else %}
        <h3>This Auction Has Ended</h3>
        <h4>The winner of this auction is {{ winnerUser }}</h4>
    {% endif %}
    <div class="itemDescription">
        <p><b>Date listed:</b> {{ attribute.date }}</p>
        <p>{{ attribute.itemDescription }}</p>
    </div>
    <form action="{% url 'comment' %}" method="POST">
        {% csrf_token %}
        {{ form.comment|safe }} 
        <input type="hidden" id="commentItemTitle" name="commentItemTitle" value="{{ attribute.itemTitle }}" >
        <input type="submit" class="btn btn-info mt-2 ml-2" value="Post" name="commentBtn">
    </form>
{% endfor %}
{% for comment in commentsFeed %}
    <p>{{ comment.user }}</p>
    <li>{{ comment.comment }}</li>
    <P>{{ comment.date }}</P>
    {% if user.is_authenticated and comment.user == request.user %}
        <form action="{% url 'delComment' %}" method="POST">
            {% csrf_token %}
            <input type="submit" value="delete" name="deleteComment" id="deleteComment">
            <input type="hidden" value="{{ comment.id }}" id="idComment" name="idComment">
            <input type="hidden" value="{{ comment.user }}" id="userComment" name="userComment">
            <input type="hidden" value="{{ comment.itemTitle }}" id="itemComment" name="itemComment">
        </form>
    {% endif %}
{% endfor %}
{% endblock %}